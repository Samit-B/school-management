<style>
    /* Chatbot Button */
    #chatbot-toggle {
        position: fixed;
        bottom: 50px;
        left: 20px; /* Position on the left */
        background-color: #2563eb;
        color: rgb(192, 238, 228);
        padding: 12px 16px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        transition: background 0.3s ease-in-out, transform 0.2s ease-in-out;
    }
    
    #chatbot-toggle:hover {
        background-color: #1d4ed8;
        transform: scale(1.05);
    }
    
    /* Chatbot Container */
    #chatbot-container {
        position: fixed;
        bottom: 500px; /* Adjusted to align with the button */
        left: 20px; /* Position on the left */
        width: 350px;
        background: rgb(199, 248, 248);
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.15);
        transform: translateY(100%); /* Start off-screen */
        transition: transform 0.3s ease-in-out;
    }
    
    #chatbot-container.open {
        transform: translateY(0); /* Slide into view */
    }
    
    /* Chatbot Header */
    #chatbot-container .bg-blue-600 {
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    
    /* Chatbot Messages */
    #chatbot-messages {
        height: 250px;
        overflow-y: auto;
        padding: 10px;
        border-bottom: 1px solid #f5ec9d;
    }
    
    /* Chatbot Input */
    #chatbot-input {
        color: #000;
        flex: 1;
        padding: 10px;
        border: 1px solid #520c62;
        border-radius: 20px;
        outline: none;
        transition: border 0.3s ease-in-out;
    }
    
    #chatbot-input:focus {
        border-color: #25ebb3;
    }
    
    /* Send & Upload Buttons */
    #chatbot-send,
    #chatbot-upload-label {
        background-color: #01b0a4;
        color: rgb(208, 46, 130);
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
        transition: background 0.3s ease-in-out, transform 0.2s ease-in-out;
    }
    
    #chatbot-send:hover,
    #chatbot-upload:hover {
        background-color: #f05942;
        transform: scale(1.1);
    }
    </style>
<button id="chatbot-toggle" class="fixed bottom-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-700 transition-colors">
    <i class="fas fa-comments"></i> Ask Me
</button>

<div id="chatbot-container" class="fixed bottom-4 right-4 w-80 bg-white shadow-xl rounded-xl transform transition-transform duration-300 ease-in-out translate-y-full hidden">

    <div class="bg-blue-600 text-white px-4 py-2 flex justify-between items-center rounded-t-xl">
        <span class="font-bold">Chatbot Assistant</span>
        <button id="chatbot-close" class="text-white hover:text-gray-300 transition-colors">&times;</button>
    </div>
    <div id="chatbot-messages" class="p-4 h-64 overflow-y-auto border-b border-gray-200">
    </div>
    <div class="p-4 bg-gray-100 rounded-b-xl flex items-center space-x-2">
        <input type="text" id="chatbot-input" class="flex-1 p-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your message...">
        <button id="chatbot-send" class="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition-colors">
            <i class="fas fa-paper-plane"></i>
        </button>
        
        <!-- Upload Button -->
        <label for="chatbot-upload" class="cursor-pointer bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition-colors">
            <i class="fas fa-upload"></i> Upload
        </label>
        <input type="file" id="chatbot-upload" class="hidden" accept="image/*, .pdf, .docx" onchange="handleFileUpload(event)" />

    </div>
</div>
<script src="/static/js/chatbot.js"></script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        let chatbotToggle = document.getElementById("chatbot-toggle");
        let chatbotContainer = document.getElementById("chatbot-container");
        let chatbotClose = document.getElementById("chatbot-close");

        chatbotToggle.addEventListener("click", function () {
            chatbotContainer.classList.toggle("hidden");
            chatbotContainer.classList.toggle("translate-y-full");
        });

        chatbotClose.addEventListener("click", function () {
            chatbotContainer.classList.add("hidden");
            chatbotContainer.classList.add("translate-y-full");
        });

        document.addEventListener("DOMContentLoaded", function () {
            let chatbotSend = document.getElementById("chatbot-send");
            let chatbotInput = document.getElementById("chatbot-input");
            let chatbotMessages = document.getElementById("chatbot-messages");

            async function sendMessage() {
                let userMessage = chatbotInput.value.trim();
                if (userMessage === "") return;

                chatbotMessages.innerHTML += `<div class='text-right mb-2'>
                    <span class="inline-block bg-blue-500 text-white p-2 rounded-lg">You: ${userMessage}</span></div>`;

                try {
                    let response = await fetch("/chatbot", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ message: userMessage })
                    });

                    let result = await response.json();

                    chatbotMessages.innerHTML += `<div class='text-left mb-2'>
                        <span class="inline-block bg-gray-200 text-gray-700 p-2 rounded-lg">Bot: ${result.reply}</span>
                    </div>`;
                    chatbotInput.value = "";
                    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
                } catch (error) {
                    console.error("Chatbot API Error:", error);
                    chatbotMessages.innerHTML += `<div class='text-left text-red-500 mb-2'>Error: Unable to fetch response</div>`;
                }
            }

            chatbotSend.addEventListener("click", sendMessage);

            chatbotInput.addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    sendMessage();
                }
            });
        });
    });

    function handleFileUpload(event) {
    const file = event.target.files[0];
    if (file) {
        console.log('File selected:', file);
        // You can now upload the file to your server or handle it further here.
        // Example of uploading to server:
        const formData = new FormData();
        formData.append("file", file);
        
        fetch('http://127.0.0.1:8000/upload-pdf', {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log("File uploaded successfully:", data);
            // You can send a message to the chatbot with the file info or process it
            document.getElementById("chatbot-messages").innerHTML += `<div class='text-left mb-2'>
                <span class="inline-block bg-gray-200 text-gray-700 p-2 rounded-lg">Bot: File uploaded successfully!</span>
            </div>`;
        })
        .catch(error => {
            console.error("Error uploading file:", error);
            document.getElementById("chatbot-messages").innerHTML += `<div class='text-left text-red-500 mb-2'>Error uploading file</div>`;
        });
    }
}
</script>